extends ../../layout/index.pug

block contenido
    div(class="min-h-screen bg-gray-100 flex")
        include ./Administrador-Sidebar/administradorSidebar.pug

        //- Contenido Principal
        main(class="flex-1 ml-64")
            //- Encabezado
            header(class="bg-white border-b border-gray-200 px-8 py-6 shadow-sm sticky top-0 z-40")
                div(class="flex items-center justify-between")
                    div(class="flex items-center space-x-4")
                        img(src="/img/usuarios.png" alt="Usuarios" class="w-12 h-12")
                        div
                            h1(class="text-2xl font-bold text-[#FF6819]") Gestión de Usuarios
                            p(class="text-gray-600") Administra los usuarios de la plataforma
            //- Mensaje de exito
            if mensajesFlash.length > 0
                //- Tener un valor que diga que si hay mensaje 
                div(id="valorMensaje" class="hidden" data-show="true")
                //- Crear un modal
                include ../../partials/MensajeModal.pug

            //- Contenedor Principal
            div(class="p-8 bg-gray-100")
                //- Sección de Filtros y Acciones
                section(class="mb-8")
                    //- Barra de Acciones
                    div(class="flex flex-col sm:flex-row justify-between items-center gap-4")
                        //- Filtros
                        form(action="/auth/administrador/usuarios" method="GET" class="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full")
                            //- Filtro de Tipo
                            div(class="relative")
                                label(for="tipo" class="block text-sm font-medium text-gray-700 mb-1") Tipo de Usuario
                                select(
                                    id="tipo" 
                                    name="tipo" 
                                    class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-[#FF6819] focus:border-transparent appearance-none bg-white"
                                )
                                    option(value="") Todos los tipos
                                    option(value="1") Vendedor
                                    option(value="2") Comprador
                                i(class="fas fa-chevron-down absolute right-3 top-8 text-gray-400 pointer-events-none")

                            //- Filtro de Estado
                            div(class="relative")
                                label(for="estado" class="block text-sm font-medium text-gray-700 mb-1") Estado
                                select(
                                    id="estado" 
                                    name="estado" 
                                    class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-[#FF6819] focus:border-transparent appearance-none bg-white"
                                )
                                    option(value="") Todos los estados
                                    option(value="1") Activo
                                    option(value="0") Inactivo
                                i(class="fas fa-chevron-down absolute right-3 top-8 text-gray-400 pointer-events-none")

                            //- Botón Buscar
                            div(class="flex items-end")
                                button(
                                    type="submit" 
                                    class="w-full sm:w-auto inline-flex items-center justify-center px-6 py-2 bg-[#FF6819] text-white rounded-lg hover:bg-[#E55A0F] transition-colors duration-200 shadow-sm hover:shadow-md cursor-pointer"
                                )
                                    i(class="fas fa-search mr-2")
                                    | Buscar

                        //- Botón Nuevo Usuario
                        a(
                            href="/auth/administrador/usuarios/crear"
                            class="w-full sm:w-auto  flex items-center justify-center px-6 py-2 bg-[#FF6819] text-white rounded-lg hover:bg-[#E55A0F] transition-colors duration-200 shadow-sm hover:shadow-md cursor-pointer "
                        )
                            i(class="fas fa-user-plus mr-2")
                            | Nuevo Usuario

                //- Tabla de Usuarios
                section(class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden")
                    //- Encabezados de la tabla
                    div(class="grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b border-gray-100 sticky top-0 z-10")
                        div(class="col-span-4")
                            p(class="font-medium text-gray-900") Usuario
                        div(class="col-span-3")
                            p(class="font-medium text-gray-900") Email
                        div(class="col-span-2")
                            p(class="font-medium text-gray-900") Tipo
                        div(class="col-span-2")
                            p(class="font-medium text-gray-900") Estado
                        div(class="col-span-1 text-right")
                            p(class="font-medium text-gray-900") Acciones

                    //- Lista de usuarios
                    div(class="divide-y divide-gray-100 max-h-[calc(100vh-400px)] overflow-y-auto")
                        if usuarios.length > 0
                        each usuario in usuarios
                            div(class="grid grid-cols-12 gap-4 p-4 hover:bg-gray-50 transition-colors duration-200")
                                //- Información del usuario
                                div(class="col-span-4 flex items-center space-x-3")
                                    img(
                                        src="/img/avatar.png"
                                        alt=usuario.nombre
                                        class="w-10 h-10 rounded-full object-cover border-2 border-orange-100"
                                    )
                                    div(class="min-w-0")
                                        p(class="font-medium text-gray-900 truncate")= usuario.nombre
                                        p(class="text-sm text-gray-500 truncate")= usuario.telefono || 'Sin teléfono'

                                //- Email
                                div(class="col-span-3 flex items-center")
                                    p(class="text-gray-600 truncate")= usuario.email

                                //- Tipo de usuario
                                div(class="col-span-2 flex items-center")
                                    span(class=`px-3 py-1 rounded-full text-sm font-medium ${
                                        usuario.tipo.toString() === '1' 
                                            ? 'bg-orange-100 text-[#FF6819]' 
                                            : 'bg-blue-100 text-blue-800'
                                    }`)
                                        = usuario.tipo.toString() === '1' ? 'Vendedor' : 'Comprador'

                                //- Estado
                                div(class="col-span-2 flex items-center")
                                    span(class=`px-3 py-1 rounded-full text-sm font-medium ${
                                        usuario.confirmado ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    }`)
                                        = usuario.confirmado ? 'Activo' : 'Inactivo'

                                //- Acciones
                                div(class="col-span-1 flex items-center justify-end space-x-2")
                                    //- Botón Editar
                                    a(
                                        href=`/auth/administrador/usuarios/editar/${usuario.id}`
                                        class="p-2 text-[#FF6819] hover:bg-orange-50 rounded-lg transition-colors duration-200"
                                        title="Editar Usuario"
                                    )
                                        i(class="fas fa-edit")
                                    
                                    //- Botón Eliminar
                                    button(
                                        type="button"
                                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200 cursor-pointer"
                                        title="Eliminar Usuario"
                                        onclick=`abrirModalEliminar('${usuario.id}', '${usuario.nombre} ${usuario.apellido}')`
                                    )
                                        i(class="fas fa-trash-alt")
                        else
                            div(class="text-center text-gray-500 py-4")
                                p(class="text-sm") No hay usuarios que coincidan con los filtros

    //- Modal de Confirmación de Eliminación
    div(id="modalEliminar" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden")
        div(class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 transform transition-all duration-300 scale-95 opacity-0")
            //- Contenido del Modal
            div(class="p-8 text-center")
                //- Icono
                div(class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6")
                    i(class="fas fa-user-times text-red-500 text-2xl")
                
                //- Título y Mensaje
                h3(class="text-xl font-semibold text-gray-900 mb-3") Eliminar Usuario
                p(class="text-gray-600 mb-6")
                    | ¿Estás seguro de que quieres eliminar a 
                    span(id="nombreUsuario" class="font-medium text-gray-900")
                    | ?

            //- Botones
            div(class="flex gap-3 px-8 pb-8")
                button(
                    onclick="cerrarModalEliminar()"
                    class="flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors duration-200 font-medium cursor-pointer"
                )
                    | Cancelar
                
                form(id="formEliminar" method="POST" class="flex-1")
                    input(type="hidden" name="_csrf" value=csrfToken)
                    button(
                        type="submit"
                        class="w-full px-4 py-3 bg-red-500 text-white rounded-xl hover:bg-red-800 transition-colors duration-200 font-medium cursor-pointer "
                    )
                        | Eliminar

block scripts
    script.
        function abrirModalEliminar(usuarioId, nombreUsuario) {
            // Actualizar el nombre del usuario
            document.getElementById('nombreUsuario').textContent = nombreUsuario;
            
            // Actualizar la acción del formulario
            document.getElementById('formEliminar').action = `/auth/administrador/usuarios/eliminar/${usuarioId}`;
            
            // Mostrar modal con animación
            const modal = document.getElementById('modalEliminar');
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modal.querySelector('.bg-white').classList.remove('scale-95', 'opacity-0');
                modal.querySelector('.bg-white').classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function cerrarModalEliminar() {
            const modal = document.getElementById('modalEliminar');
            const modalContent = modal.querySelector('.bg-white');
            
            // Animación de salida
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 500);
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('modalEliminar').addEventListener('click', function(e) {
            if (e.target === this) cerrarModalEliminar();
        });

        // Cerrar con Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') cerrarModalEliminar();
        });
    script.
        //- Recoger el valor del mensaje
        const valorMensaje = document.getElementById('valorMensaje');
        if (valorMensaje.dataset.show === 'true') {
            //- Mostrar el modal
            const modalMensaje = document.getElementById('modalMensaje');
            modalMensaje.classList.remove('hidden');

            //- Animacion de entrada
            setTimeout(() => {
                modalMensaje.querySelector('.bg-white').classList.remove('scale-95', 'opacity-0');
                modalMensaje.querySelector('.bg-white').classList.add('scale-100', 'opacity-100');
            }, 10);
        }
        //- Cerrar el modal cuando se haga click en el boton de aceptar
        function cerrarModalMensajeEditar() {
            //- Encontrar el modal
            const modal = document.getElementById('modalMensaje');
            modal.classList.add('hidden');

            //- Animacion de salida
            setTimeout(() => {
                modal.querySelector('.bg-white').classList.remove('scale-100', 'opacity-100');
                modal.querySelector('.bg-white').classList.add('scale-95', 'opacity-0');
            }, 500);
        }
        //- Cerrar cuando se haga click fuera
        document.getElementById('modalMensaje').addEventListener('click', function(e) {            
            if (e.target === this) cerrarModalMensajeEditar();
        })
        //- Cerrar con Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') cerrarModalMensajeEditar();
        })
