extends ../layout/index.pug

block styles
block contenido
    div(class="min-h-screen bg-gray-100")
        include ../usuario/comprador-Sidebar/compradorSidebar.pug
        
        //- Contenido Principal
        main(class="flex-1 p-6 ")

            //- Mensajes de Exito
            if mensajesFlash.length > 0
                //- tener un valor que diga que si hay mensajes
                include ../partials/MensajeModal.pug
                div(id="valorMensaje" class="hidden" data-show="true")
                
            //- Contenedor Principal
            div(class="max-w-7xl mx-auto")
                //- Sección de Perfil
                div(class="bg-white rounded-xl shadow-sm overflow-hidden mb-8")
                    //- Cabecera del Perfil
                    div(class="relative h-48 bg-gradient-to-r from-[#FF6819] to-[#FF9F00]")
                        div(class="absolute -bottom-16 left-8")
                            img(src="/img/avatar.png" alt="Foto de Perfil" class="w-32 h-32 rounded-full border-4 border-white shadow-lg")
                    
                    //- Información del Perfil
                    div(class="pt-20 pb-8 px-8")
                        div(class="flex justify-between items-start")
                            div
                                h1(class="text-3xl font-bold text-gray-900")= usuario.nombre
                                p(class="text-gray-600 mt-1")= usuario.email
                                div(class="flex items-center mt-2 space-x-2")
                                    span(class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium")= usuario.tipo.toString() === '1' ? 'Vendedor' : 'Comprador'
                                    span(class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium") Miembro desde #{usuario.createdAt.toLocaleDateString()}
                            
                            //- Estadísticas
                            div(class="grid grid-cols-3 gap-6 text-center")
                                div
                                    p(class="text-2xl font-bold text-[#FF6819]")= propiedades.length
                                    p(class="text-sm text-gray-600") Propiedades
                                div
                                    p(class="text-2xl font-bold text-[#FF6819]")= propiedades.length
                                    p(class="text-sm text-gray-600") Ventas

                        //- Información de Contacto
                        div(class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8")
                            div(class="space-y-4")
                                h3(class="text-lg font-semibold text-gray-900") Información de Contacto
                                div(class="space-y-3")
                                    div(class="flex items-center space-x-3")
                                        i(class="fas fa-phone text-[#FF6819]")
                                        span(class="text-gray-600")= usuario.telefono
                                    div(class="flex items-center space-x-3")
                                        i(class="fas fa-envelope text-[#FF6819]")
                                        span(class="text-gray-600")= usuario.email
                                    div(class="flex items-center space-x-3")
                                        i(class="fas fa-map-marker-alt text-[#FF6819]")
                                        span(class="text-gray-600") Trujillo, Perú
                            
                            //- Horario de Atención
                            div(class="space-y-4")
                                h3(class="text-lg font-semibold text-gray-900") Horario de Atención
                                div(class="space-y-2")
                                    div(class="flex justify-between")
                                        span(class="text-gray-600") Lunes - Viernes
                                        span(class="text-gray-900 font-medium") 9:00 AM - 5:00 PM
                                    div(class="flex justify-between")
                                        span(class="text-gray-600") Sábados
                                        span(class="text-gray-900 font-medium") 9:00 AM - 1:00 PM
                                    div(class="flex justify-between")
                                        span(class="text-gray-600") Domingos
                                        span(class="text-gray-900 font-medium") Cerrado

                //- Sección de Propiedades Destacadas
                div(class="bg-white rounded-xl shadow-sm p-8 mb-8")
                    h2(class="text-2xl font-bold text-gray-900 mb-6") Propiedades
                    div(class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6")
                        each propiedad in propiedades
                            //- Propiedad 1
                            div(class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300")
                                img(src=`/uploads/${propiedad.imagen}` alt="Propiedad" class="w-full h-48 object-cover")
                                div(class="p-4")
                                    h3(class="text-lg font-semibold text-gray-900")= propiedad.titulo
                                    p(class="text-[#FF6819] font-bold mt-1") $ #{propiedad.precio.toLocaleString()}
                                    div(class="flex items-center justify-between mt-2")
                                        span(class="text-gray-600 text-sm")= propiedad.habitaciones + ' Hab | ' + propiedad.wc + ' Baños | ' + propiedad.estacionamiento + ' Est'
                                        a(href=`/propiedades/${propiedad.id}` class="text-[#FF6819] hover:text-[#E55A0F]") Ver Detalles

                //- Sección de Calificaciones y Comentarios
                div(class="bg-white rounded-xl shadow-sm p-8")
                    h2(class="text-2xl font-bold text-gray-900 mb-6") Calificaciones y Comentarios
                    
                    //- Formulario de Calificación
                    div(class="bg-gray-50 rounded-lg p-6 mb-8")
                        h3(class="text-lg font-semibold text-gray-900 mb-4") Deja tu Calificación                
                        form(action=`/comentario-calificacion/crear-comentario-calificacion/${usuario.id}` method="POST" novalidate)
                            input(type="hidden" name="_csrf" value=csrfToken)
                            
                            //- Contenedor de estrellas con radios
                            div(class="mb-4")
                                label(for="calificacion" class="block text-sm font-medium text-gray-700 mb-2") Calificación
                                div(class="flex items-center space-x-1" id="contenedor-estrellas")
                                    each i in [1,2,3,4,5]
                                        div(class="relative")
                                            input(
                                                type="radio" 
                                                name="calificacion" 
                                                id=`calificacion-${i}` 
                                                value=i 
                                                class="peer hidden"
                                            )
                                            label(
                                                for=`calificacion-${i}` 
                                                class="text-2xl text-gray-300 hover:text-[#FF6819] cursor-pointer transition-colors duration-200"
                                                data-rating=i
                                            )
                                                i(class="fas fa-star")
                                
                            -const calificacion = errores?.find(error => error.path === 'calificacion')
                                if calificacion
                                    p(class="text-red-500 text-sm")= calificacion.msg
                            //- Comentario
                            div(class="mb-4")
                                label(for="comentario" class="block text-sm font-medium text-gray-700 mb-2") Comentario
                                textarea(
                                    id="comentario"
                                    name="comentario"
                                    rows="3"
                                    class="w-full rounded-lg border-gray-300 shadow-sm focus:border-[#FF6819] focus:ring-[#FF6819]"
                                    placeholder="Cuéntanos tu experiencia..."
                                    required
                                )
                                -const comentario = errores?.find(error => error.path === 'comentario')
                                    if comentario
                                        p(class="text-red-500 text-sm")= comentario.msg
                            button(
                                type="submit"
                                class="w-full bg-[#FF6819] text-white px-4 py-2 rounded-lg hover:bg-[#E55A0F] transition-colors duration-300 cursor-pointer"
                            ) Enviar Calificación

                    //- Lista de Calificaciones
                    div(class="space-y-6")
                        each comentario in comentarios
                            //- Calificación
                            div(class="border-b border-gray-200 pb-6")
                                //- Header con información del usuario y acciones
                                div(class="flex items-center justify-between mb-3")
                                    div(class="flex items-center space-x-3")
                                        img(src="/img/avatar.png" alt="Usuario" class="w-10 h-10 rounded-full")
                                        div
                                            h4(class="font-semibold text-gray-900")= comentario.evaluadorRelacion.nombre
                                            p(class="text-sm text-gray-500") Hace #{comentario.createdAt.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}  
                                    //- Acciones (Editar y Eliminar)
                                    if comentario.evaluadorId === evaluador.id
                                        div(class="flex items-center space-x-3")
                                            a(
                                                href=`/comentario-calificacion/editar-comentario-calificacion/${comentario.id}` 
                                                class="text-[#FF6819] hover:text-[#E55A0F] text-sm font-medium transition-colors duration-200"
                                            )
                                                i(class="fas fa-edit mr-1")
                                                | Editar
                                            button(
                                                class="text-red-500 hover:text-red-700 text-sm font-medium transition-colors duration-200 cursor-pointer" 
                                                onclick=`abrirModalEliminarMensaje(${comentario.id}, 'Eliminar Comentario', '¿Estás seguro de querer eliminar este comentario?', '/comentario-calificacion/eliminar-comentario-calificacion/${comentario.id}')`
                                                type="button"
                                            )
                                                i(class="fas fa-trash mr-1")
                                                | Eliminar
                                            include ../partials/MensajeEliminar.pug
                                
                                //- Calificación con estrellas
                                div(class="flex items-center mb-3")
                                    each i in [1,2,3,4,5]
                                        i(class=`fas fa-star text-lg ${i <= comentario.calificacion ? 'text-[#FF6819]' : 'text-gray-300'}`)
                                    span(class="ml-2 text-sm text-gray-600") #{comentario.calificacion} de 5 estrellas
                                
                                //- Comentario
                                p(class="text-gray-600 leading-relaxed")= comentario.comentario


    include ../layout/footer.pug

block scripts
    script(src="/js/agregarVentanaModal.js")
    script(src="/js/ModalEliminar.js")
    script.
        // Script para el sistema de calificaciones
        document.addEventListener('DOMContentLoaded', function() {
            const contenedorEstrellas = document.getElementById('contenedor-estrellas');
            const labels = contenedorEstrellas.querySelectorAll('label[data-rating]');
            const inputs = contenedorEstrellas.querySelectorAll('input[type="radio"]');
            let ratingSeleccionado = 0;

            // Función para actualizar las estrellas
            function actualizarEstrellas(rating) {
                labels.forEach((label, index) => {
                    const ratingLabel = parseInt(label.dataset.rating);
                    if (ratingLabel <= rating) {
                        label.classList.remove('text-gray-300');
                        label.classList.add('text-[#FF6819]');
                    } else {
                        label.classList.remove('text-[#FF6819]');
                        label.classList.add('text-gray-300');
                    }
                });
            }

            // Event listener para cada label
            labels.forEach(label => {
                const rating = parseInt(label.dataset.rating);
                
                // Click en la estrella
                label.addEventListener('click', function() {
                    ratingSeleccionado = rating;
                    actualizarEstrellas(rating);
                });

                // Hover sobre la estrella
                label.addEventListener('mouseenter', function() {
                    actualizarEstrellas(rating);
                });

                // Salir del hover
                label.addEventListener('mouseleave', function() {
                    actualizarEstrellas(ratingSeleccionado);
                });
            });

            // Event listener para los inputs (por si acaso)
            inputs.forEach(input => {
                input.addEventListener('change', function() {
                    ratingSeleccionado = parseInt(this.value);
                    actualizarEstrellas(ratingSeleccionado);
                });
            });
        }); 