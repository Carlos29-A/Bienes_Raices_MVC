extends ../layout/index

block styles
    meta(name="csrf-token" content=csrfToken)

block contenido
    div(class="min-h-screen bg-gray-100 flex")
        include ../usuario/comprador-Sidebar/compradorSidebar.pug
        
        //- Contenido Principal
        div(class="flex-1")
            //- Header
            header(class="bg-white shadow-sm sticky top-0 z-10")
                div(class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8")
                    h1(class="text-2xl font-bold text-gradient-to-r from-[#FF641A] to-[#FF9F00] bg-gradient-to-r from-[#FF641A] to-[#FF9F00] text-transparent bg-clip-text") Buscar Propiedades

            //- Contenido Principal
            main(class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8")
                //- Sección de Filtros
                section(class="bg-white rounded-lg shadow-sm mb-8")
                    div(class="px-6 py-4 border-b border-gray-200")
                        h2(class="text-lg font-bold text-[#1E2939]") Filtros de Búsqueda
                    
                    div(class="p-6")
                        form(class="space-y-6" action="/propiedades/buscar" method="GET")
                            //- Filtros Principales
                            div(class="grid grid-cols-1 md:grid-cols-4 gap-4")
                                //- Ubicación
                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="ubicacion") Ubicación
                                    input#ubicacion_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        type="text"
                                        name="calle"
                                        placeholder="Ciudad, Zona..."
                                    )

                                //- Tipo de Propiedad
                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="categoria") Categoría
                                    select#categoria_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        name="categoria"
                                    )
                                        option(value="") Seleccione
                                        each categoria in categorias
                                            option(value=categoria.id)= categoria.nombre

                                //- Rango de Precio
                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="precio_min") Precio Mínimo
                                    input#precio_min_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        type="number"
                                        name="precio_min"
                                        placeholder="$"
                                    )

                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="precio_max") Precio Máximo
                                    input#precio_max_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        type="number"
                                        name="precio_max"
                                        placeholder="$"
                                    )

                            //- Filtros Adicionales
                            div(class="grid grid-cols-1 md:grid-cols-4 gap-4")
                                //- Habitaciones
                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="habitaciones") Habitaciones
                                    select#habitaciones_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        name="habitaciones"
                                    )
                                        option(value="") Seleccione
                                        - for(let i = 1; i <= 5; i++)
                                            option(value=i)= i

                                //- Baños
                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="wc") Baños
                                    select#wc_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        name="wc"
                                    )
                                        option(value="") Seleccione
                                        - for(let i = 1; i <= 5; i++)
                                            option(value=i)= i

                                //- Estacionamientos
                                div
                                    label(class="block text-sm font-medium text-[#1E2939]" for="estacionamiento") Estacionamientos
                                    select#estacionamiento_comprador(
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white"
                                        name="estacionamiento"
                                    )
                                        option(value="") Seleccione
                                        - for(let i = 1; i <= 5; i++)
                                            option(value=i)= i

                                //- Botón de Búsqueda
                                div(class="flex items-end")
                                    button(
                                        type="submit"
                                        class="w-full bg-gradient-to-r from-[#FF641A] to-[#FF9F00] text-white px-4 py-2 rounded-md hover:scale-105  transition-colors duration-200 flex items-center justify-center cursor-pointer "
                                    )
                                        i(class="fas fa-search mr-2")
                                        | Buscar Propiedades

                //- Sección de Resultados
                section(class="bg-white rounded-lg shadow-sm")
                    div(class="px-6 py-4 border-b border-gray-200")
                        div(class="flex justify-between items-center")
                            h2(class="text-lg font-medium text-gray-900") Resultados de la Búsqueda
                            p(class="text-sm text-gray-600")
                                | Mostrando 
                                span(class="font-semibold")= propiedades ? propiedades.length : 0
                                |  propiedades

                    div(class="p-6 bg-gray-50")
                        if propiedades && propiedades.length
                            div(class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6")
                                each propiedad in propiedades
                                    article(class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-200 flex flex-col h-[32rem]")
                                        //- Imagen de la Propiedad
                                        div(class="relative group h-48")
                                            img(
                                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                                src=`/uploads/${propiedad.imagen}`
                                                alt=propiedad.titulo
                                            )
                                            //- Botón de Favoritos
                                            button(
                                                class=`absolute top-2 right-2 p-2 bg-white rounded-full shadow-md hover:bg-red-50 transition-colors duration-200 agregar-favorito ${favoritos.some(favorito => favorito.propiedadId === propiedad.id) ? 'text-red-500' : 'text-gray-400'}`
                                                data-propiedad-id=propiedad.id
                                                data-usuario-id=propiedad.usuarioRelacion.id
                                            )
                                                i(class="fas fa-heart")

                                        //- Detalles de la Propiedad
                                        div(class="p-4 flex flex-col flex-grow")
                                            //- Título y Precio
                                            div(class="space-y-2 mb-3")
                                                h3(class="text-lg font-semibold text-gray-900 line-clamp-2 h-14")= propiedad.titulo
                                                p(class="text-blue-600 font-bold text-xl") $ #{propiedad.precio.toLocaleString()}
                                            
                                            //- Ubicación y Categoría
                                            div(class="flex flex-col space-y-1 text-sm text-gray-600 mb-3")
                                                div(class="flex items-center")
                                                    i(class="fas fa-map-marker-alt w-5 text-gray-500")
                                                    span(class="ml-2 truncate")= propiedad.calle
                                                div(class="flex items-center")
                                                    i(class="fas fa-building w-5 text-gray-500")
                                                    span(class="ml-2 truncate")= propiedad.categoriaRelacion.nombre
                                            
                                            //- Características
                                            div(class="flex flex-col space-y-2 text-sm text-gray-600 border-t border-gray-100 pt-3 mb-4")
                                                div(class="flex items-center")
                                                    i(class="fas fa-bed w-5 text-gray-500")
                                                    span(class="ml-2")= propiedad.habitaciones + ' Habitaciones'
                                                div(class="flex items-center")
                                                    i(class="fas fa-bath w-5 text-gray-500")
                                                    span(class="ml-2")= propiedad.wc + ' Baños'
                                                div(class="flex items-center")
                                                    i(class="fas fa-parking w-5 text-gray-500")
                                                    span(class="ml-2")= propiedad.estacionamiento + ' Estacionamientos'
                                            
                                            //- Botones de Acción
                                            div(class="flex space-x-2 mt-auto")
                                                a(
                                                    href=`/propiedades/${propiedad.id}`
                                                    class="flex-1 bg-gradient-to-r from-[#FF641A] to-[#FF9F00] text-white text-center py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-200 text-sm"
                                                )
                                                    | Ver Detalles
                                                a(
                                                    href=`/mensajes/enviar/${propiedad.id}/${propiedad.usuarioRelacion.id}`
                                                    class="bg-gray-100 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-200 transition-colors duration-200 text-sm text-center flex-1"
                                                )
                                                    | Contactar

                        else
                            div(class="text-center py-12")
                                i(class="fas fa-search text-gray-300 text-5xl mb-4")
                                p(class="text-gray-500 text-lg") No se encontraron propiedades que coincidan con tu búsqueda
                                p(class="text-gray-400 mt-2") Intenta ajustar los filtros para ver más resultados

block scripts
    script(src="/js/agregarFavorito.js")
